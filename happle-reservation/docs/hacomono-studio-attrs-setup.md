# hacomono 店舗属性（attrs）設定ガイド

## 概要

予約システムで使用する店舗固有の情報を設定できます。  
URLパラメータで指定がない場合、hacomonoの店舗情報からフォールバック取得します。

## 優先順位

1. **URLパラメータ**（リンク生成時に指定）- 最優先
2. **hacomono店舗設定**（標準フィールド + attrs）- フォールバック

URLパラメータで明示的に値が指定されている場合はその値を使用し、指定がない場合のみhacomonoの店舗設定から取得します。

---

## 標準フィールド（自動取得）

以下の情報はhacomonoの店舗標準フィールドから自動取得されます：

| 項目 | hacomonoフィールド | 説明 |
|------|-------------------|------|
| 郵便番号 | `zip_code1`, `zip_code2` | 「XXX」「XXXX」形式で保存、システムが結合して「XXX-XXXX」形式で表示 |
| 住所 | `prefecture`, `address1`, `address2`, `address3` | 都道府県と住所を結合して表示 |
| 電話番号 | `tel` | 店舗の電話番号 |

---

## attrs に設定するキー

以下の情報は店舗の「属性（attrs）」に設定してください：

| キー名 | 説明 | 例 |
|--------|------|-----|
| `line_url` | LINE公式アカウントURL | `https://lin.ee/SK9pvTs` |
| `studio_email` | 店舗メールアドレス | `info@example.com` |
| `studio_url` | 店舗WebサイトURL | `https://example.com` |

### 設定方法

1. hacomono管理画面にログイン
2. **マスタ** > **店舗** を選択
3. 対象店舗を選択
4. 「属性」セクションでキーと値を追加

### 設定例

```
キー: line_url
値: https://lin.ee/SK9pvTs

キー: studio_email
値: info@asmy-kumamoto.com

キー: studio_url
値: https://asmy-kumamoto.com
```

---

## URLパラメータ一覧

リンク生成ツールで指定可能なパラメータ：

| パラメータ名 | 説明 | 例 |
|-------------|------|-----|
| `line_url` | LINE公式アカウントURL | `https://lin.ee/SK9pvTs` |
| `studio_zip` | 店舗郵便番号 | `860-0845` |
| `studio_address` | 店舗住所 | `熊本県熊本市中央区上通町イーストンビル1階` |
| `studio_tel` | 店舗電話番号 | `090-3243-2739` |
| `studio_url` | 店舗WebサイトURL | `https://example.com` |
| `studio_email` | 店舗メールアドレス | `info@example.com` |

---

## データフロー

```
┌─────────────────────────────────────────────────────────────┐
│                    リンク生成ツール                          │
│  (admin/link-generator)                                     │
│                                                             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐ │
│  │ 店舗選択    │  │ LINE URL    │  │ 店舗連絡先情報      │ │
│  └─────────────┘  └─────────────┘  │ (zip/address/tel等) │ │
│                                     └─────────────────────┘ │
└──────────────────────────┬──────────────────────────────────┘
                           │
                           ▼ URLパラメータとして送信
┌─────────────────────────────────────────────────────────────┐
│                   バックエンド (app.py)                      │
│                                                             │
│  予約作成時:                                                 │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  1. URLパラメータをチェック                          │   │
│  │  2. 値がなければ hacomono店舗情報から取得             │   │
│  │     - 標準フィールド: tel, zip_code, address等        │   │
│  │     - attrs: line_url, studio_email, studio_url       │   │
│  │  3. 取得した情報でメール送信                          │   │
│  └─────────────────────────────────────────────────────┘   │
└──────────────────────────┬──────────────────────────────────┘
                           │
                           ▼
┌─────────────────────────────────────────────────────────────┐
│                     表示先                                   │
│                                                             │
│  ┌─────────────────┐  ┌─────────────────┐                   │
│  │ 予約確認メール   │  │ 予約完了ページ  │                   │
│  │ (テキスト)      │  │ (complete)      │                   │
│  └─────────────────┘  └─────────────────┘                   │
│                                                             │
│  ┌─────────────────┐                                        │
│  │ 予約詳細ページ  │                                        │
│  │ (reservation-   │                                        │
│  │  detail)        │                                        │
│  └─────────────────┘                                        │
└─────────────────────────────────────────────────────────────┘
```

---

## 注意事項

- 各フィールドは空でも可（空の場合は該当項目が表示されません）
- LINE URLが設定されている場合のみ、メール・ページにLINE関連セクションが表示されます
- hacomonoのattrsに値を設定した場合、URLパラメータで上書き指定しない限りその値が使用されます
- 店舗ごとに異なるLINE URLやメールアドレスを使い分ける場合は、各店舗のattrsに設定するか、リンク生成時に指定してください

---

## APIレスポンス例（参考）

hacomono APIの店舗情報レスポンス構造（抜粋）：

```json
{
  "data": {
    "studio": {
      "id": 1,
      "name": "ASMY熊本店",
      "zip_code1": "860",
      "zip_code2": "0845",
      "prefecture": "熊本県",
      "address1": "熊本市中央区",
      "address2": "上通町",
      "address3": "イーストンビル1階",
      "tel": "090-3243-2739",
      "attrs": [
        {
          "key": "line_url",
          "value": "https://lin.ee/SK9pvTs"
        },
        {
          "key": "studio_email",
          "value": "info@asmy-kumamoto.com"
        },
        {
          "key": "studio_url",
          "value": "https://asmy-kumamoto.com"
        }
      ]
    }
  }
}
```














