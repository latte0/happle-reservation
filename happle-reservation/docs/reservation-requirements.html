<!DOCTYPE html>
<html>
<head>
<title>reservation-requirements.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="hacomono-%E4%BA%88%E7%B4%84%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0-%E5%BF%85%E9%A0%88%E6%9D%A1%E4%BB%B6%E3%83%BB%E5%88%B6%E7%B4%84%E3%81%BE%E3%81%A8%E3%82%81">hacomono 予約システム 必須条件・制約まとめ</h1>
<h2 id="%E6%A6%82%E8%A6%81">概要</h2>
<p>hacomono APIには2種類の予約方式があります：</p>
<table>
<thead>
<tr>
<th>予約タイプ</th>
<th>エンドポイント</th>
<th>特徴</th>
</tr>
</thead>
<tbody>
<tr>
<td>固定枠予約（レッスン）</td>
<td><code>POST /reservation/reservations/reserve</code></td>
<td>事前に作成したレッスン枠に対して予約</td>
</tr>
<tr>
<td>自由枠予約（choice）</td>
<td><code>POST /reservation/reservations/choice/reserve</code></td>
<td>営業時間内で自由に時間を選んで予約</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="%E5%9B%BA%E5%AE%9A%E6%9E%A0%E4%BA%88%E7%B4%84-vs-%E8%87%AA%E7%94%B1%E6%9E%A0%E4%BA%88%E7%B4%84%E8%A9%B3%E7%B4%B0%E6%AF%94%E8%BC%83">固定枠予約 vs 自由枠予約（詳細比較）</h2>
<h3 id="%E5%9F%BA%E6%9C%AC%E7%9A%84%E3%81%AA%E9%81%95%E3%81%84">基本的な違い</h3>
<table>
<thead>
<tr>
<th>項目</th>
<th>固定枠予約（レッスン予約）</th>
<th>自由枠予約（choice予約）</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>API</strong></td>
<td><code>POST /reservation/reservations/reserve</code></td>
<td><code>POST /reservation/reservations/choice/reserve</code></td>
</tr>
<tr>
<td><strong>特徴</strong></td>
<td>事前に作成したレッスン枠に予約</td>
<td>営業時間内で自由に時間を選んで予約</td>
</tr>
<tr>
<td><strong>時間選択</strong></td>
<td>レッスン枠で決まっている</td>
<td>ユーザーが開始時間を指定</td>
</tr>
<tr>
<td><strong>席番号(no)</strong></td>
<td>必要（自動で空き席を選択）</td>
<td>不要</td>
</tr>
<tr>
<td><strong>用途</strong></td>
<td>グループレッスン、定時クラス</td>
<td>パーソナルトレーニング、個別予約</td>
</tr>
</tbody>
</table>
<h3 id="%E4%BA%88%E7%B4%84%E3%81%AE%E6%B5%81%E3%82%8C">予約の流れ</h3>
<h4 id="%E5%9B%BA%E5%AE%9A%E6%9E%A0%E4%BA%88%E7%B4%84%E3%81%AE%E6%B5%81%E3%82%8C">固定枠予約の流れ</h4>
<pre class="hljs"><code><div>┌─────────────────────────────────────────────────────────────┐
│                    固定枠予約の流れ                          │
└─────────────────────────────────────────────────────────────┘

  管理者                    ユーザー                  システム
    │                         │                        │
    │  レッスン枠を作成        │                        │
    │  (12/13 10:00 ピラティス) │                        │
    │ ───────────────────────────────────────────────&gt; │
    │                         │                        │
    │                         │  レッスン一覧を見る     │
    │                         │ ─────────────────────&gt; │
    │                         │                        │
    │                         │  「12/13 10:00」を選択  │
    │                         │ ─────────────────────&gt; │
    │                         │                        │
    │                         │  空き席(no=2)に自動予約 │
    │                         │ &lt;───────────────────── │
</div></code></pre>
<h4 id="%E8%87%AA%E7%94%B1%E6%9E%A0%E4%BA%88%E7%B4%84%E3%81%AE%E6%B5%81%E3%82%8C">自由枠予約の流れ</h4>
<pre class="hljs"><code><div>┌─────────────────────────────────────────────────────────────┐
│                    自由枠予約の流れ                          │
└─────────────────────────────────────────────────────────────┘

  管理者                    ユーザー                  システム
    │                         │                        │
    │  営業時間を設定          │                        │
    │  (9:00〜21:00)          │                        │
    │ ───────────────────────────────────────────────&gt; │
    │                         │                        │
    │  スタッフシフトを設定    │                        │
    │ ───────────────────────────────────────────────&gt; │
    │                         │                        │
    │                         │  空き状況を確認        │
    │                         │ ─────────────────────&gt; │
    │                         │                        │
    │                         │  「14:30から30分」を選択│
    │                         │ ─────────────────────&gt; │
    │                         │                        │
    │                         │  スタッフを自動/手動選択│
    │                         │ &lt;───────────────────── │
</div></code></pre>
<h3 id="%E5%BF%85%E8%A6%81%E3%81%AAapi%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF">必要なAPIパラメータ</h3>
<h4 id="%E5%9B%BA%E5%AE%9A%E6%9E%A0%E4%BA%88%E7%B4%84">固定枠予約</h4>
<pre class="hljs"><code><div>{
  <span class="hljs-attr">"member_id"</span>: <span class="hljs-number">49</span>,
  <span class="hljs-attr">"studio_lesson_id"</span>: <span class="hljs-number">248</span>,    <span class="hljs-comment">// ← レッスン枠ID（必須）</span>
  <span class="hljs-attr">"no"</span>: <span class="hljs-string">"2"</span>,                   <span class="hljs-comment">// ← 席番号（自動選択）</span>
  <span class="hljs-attr">"member_ticket_id"</span>: <span class="hljs-number">43</span>
}
</div></code></pre>
<h4 id="%E8%87%AA%E7%94%B1%E6%9E%A0%E4%BA%88%E7%B4%84">自由枠予約</h4>
<pre class="hljs"><code><div>{
  <span class="hljs-attr">"member_id"</span>: <span class="hljs-number">34</span>,
  <span class="hljs-attr">"studio_room_id"</span>: <span class="hljs-number">3</span>,         <span class="hljs-comment">// ← 部屋ID（必須）</span>
  <span class="hljs-attr">"program_id"</span>: <span class="hljs-number">2</span>,             <span class="hljs-comment">// ← プログラムID（必須）</span>
  <span class="hljs-attr">"start_at"</span>: <span class="hljs-string">"2025-12-13 14:30:00.000"</span>,  <span class="hljs-comment">// ← 自分で指定</span>
  <span class="hljs-attr">"instructor_ids"</span>: [<span class="hljs-number">1</span>],       <span class="hljs-comment">// ← スタッフID（必須）</span>
  <span class="hljs-attr">"ticket_id"</span>: <span class="hljs-number">5</span>
}
</div></code></pre>
<h3 id="%E7%AE%A1%E7%90%86%E7%94%BB%E9%9D%A2%E3%81%A7%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%81%AE%E9%81%95%E3%81%84">管理画面での設定の違い</h3>
<table>
<thead>
<tr>
<th>設定項目</th>
<th style="text-align:center">固定枠予約</th>
<th style="text-align:center">自由枠予約</th>
</tr>
</thead>
<tbody>
<tr>
<td>スタジオルーム作成</td>
<td style="text-align:center">✅ 予約タイプ:「固定枠」</td>
<td style="text-align:center">✅ 予約タイプ:「自由枠」</td>
</tr>
<tr>
<td>レッスン枠作成</td>
<td style="text-align:center">✅ 必須</td>
<td style="text-align:center">❌ 不要</td>
</tr>
<tr>
<td>スペース設定（席番号）</td>
<td style="text-align:center">✅ 必須（<code>no</code>フィールド）</td>
<td style="text-align:center">❌ 不要</td>
</tr>
<tr>
<td>月次シフト作成</td>
<td style="text-align:center">△ 任意</td>
<td style="text-align:center">✅ 必須</td>
</tr>
<tr>
<td>営業時間設定</td>
<td style="text-align:center">△ 任意</td>
<td style="text-align:center">✅ 必須</td>
</tr>
<tr>
<td>スタッフシフト設定</td>
<td style="text-align:center">△ 任意</td>
<td style="text-align:center">✅ 必須</td>
</tr>
<tr>
<td>ルームサービス設定</td>
<td style="text-align:center">❌ 不要</td>
<td style="text-align:center">✅ 必須（期間設定）</td>
</tr>
</tbody>
</table>
<h3 id="%E7%8F%BE%E5%9C%A8%E3%81%AE%E8%A8%AD%E5%AE%9Atest-studio">現在の設定（Test Studio）</h3>
<table>
<thead>
<tr>
<th>部屋名</th>
<th>タイプ</th>
<th>studio_room_id</th>
<th>備考</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Pilates Room</strong></td>
<td>固定枠予約</td>
<td>5</td>
<td>レッスン枠から予約</td>
</tr>
<tr>
<td><strong>Test Room</strong></td>
<td>自由枠予約</td>
<td>3 or 4</td>
<td>時間を自由に選択</td>
</tr>
</tbody>
</table>
<h3 id="%E3%81%A9%E3%81%A1%E3%82%89%E3%82%92%E4%BD%BF%E3%81%86%E3%81%B9%E3%81%8D">どちらを使うべき？</h3>
<table>
<thead>
<tr>
<th>ユースケース</th>
<th>推奨</th>
</tr>
</thead>
<tbody>
<tr>
<td>グループレッスン（ヨガ、ピラティスなど）</td>
<td><strong>固定枠予約</strong></td>
</tr>
<tr>
<td>定員のあるクラス</td>
<td><strong>固定枠予約</strong></td>
</tr>
<tr>
<td>パーソナルトレーニング</td>
<td><strong>自由枠予約</strong></td>
</tr>
<tr>
<td>施術・エステなど個別予約</td>
<td><strong>自由枠予約</strong></td>
</tr>
<tr>
<td>スタッフが時間を柔軟に対応</td>
<td><strong>自由枠予約</strong></td>
</tr>
</tbody>
</table>
<hr>
<h2 id="%E3%82%B2%E3%82%B9%E3%83%88%E4%BA%88%E7%B4%84%E3%81%AE%E6%B5%81%E3%82%8C%E9%87%8D%E8%A6%81">ゲスト予約の流れ（重要）</h2>
<h3 id="%E3%83%81%E3%82%B1%E3%83%83%E3%83%88%E3%81%A8%E3%81%AF">チケットとは？</h3>
<p><strong>チケット = 予約するための権利（回数券のようなもの）</strong></p>
<ul>
<li>メンバーがチケットを持っていないと予約できない（<code>RSV_000005</code>エラー）</li>
<li>管理画面で事前にチケットを作成しておく必要がある</li>
<li>予約時にチケットが消費される</li>
</ul>
<h3 id="%E7%8F%BE%E5%9C%A8%E3%81%AE%E3%83%81%E3%82%B1%E3%83%83%E3%83%88%E4%B8%80%E8%A6%A7">現在のチケット一覧</h3>
<table>
<thead>
<tr>
<th>ID</th>
<th>名前</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Trial Ticket</td>
<td>体験用</td>
</tr>
<tr>
<td>2</td>
<td>One Time Ticket</td>
<td>1回券</td>
</tr>
<tr>
<td>3</td>
<td>初回体験</td>
<td>初回用</td>
</tr>
<tr>
<td>4</td>
<td>Test Ticket</td>
<td>テスト</td>
</tr>
<tr>
<td><strong>5</strong></td>
<td><strong>Web予約チケット</strong></td>
<td><strong>ゲスト予約用</strong> ✅</td>
</tr>
</tbody>
</table>
<h3 id="%E3%82%B2%E3%82%B9%E3%83%88%E4%BA%88%E7%B4%84%E3%81%AE%E8%87%AA%E5%8B%95%E5%8C%96%E3%83%95%E3%83%AD%E3%83%BC">ゲスト予約の自動化フロー</h3>
<pre class="hljs"><code><div>┌─────────────────────────────────────────────────────────────┐
│                    ゲスト予約フロー                          │
└─────────────────────────────────────────────────────────────┘

  ゲスト              Backend API              hacomono API
    │                     │                        │
    │  予約リクエスト      │                        │
    │ ─────────────────&gt; │                        │
    │                     │                        │
    │                     │  1. メンバー作成        │
    │                     │ ────────────────────&gt; │
    │                     │      member_id        │
    │                     │ &lt;──────────────────── │
    │                     │                        │
    │                     │  2. チケット付与        │
    │                     │     (ticket_id: 5)    │
    │                     │ ────────────────────&gt; │
    │                     │   member_ticket_id    │
    │                     │ &lt;──────────────────── │
    │                     │                        │
    │                     │  3. 予約作成           │
    │                     │ ────────────────────&gt; │
    │                     │    reservation_id     │
    │                     │ &lt;──────────────────── │
    │                     │                        │
    │    予約完了         │                        │
    │ &lt;───────────────── │                        │
</div></code></pre>
<h3 id="%E3%83%90%E3%83%83%E3%82%AF%E3%82%A8%E3%83%B3%E3%83%89%E3%81%A7%E3%81%AE%E8%87%AA%E5%8B%95%E5%87%A6%E7%90%86">バックエンドでの自動処理</h3>
<ol>
<li><strong>メンバー自動作成</strong>: ゲストの情報（名前、メール、電話番号）でメンバーを作成</li>
<li><strong>チケット自動付与</strong>: <code>ticket_id: 5</code>（Web予約チケット）を1枚付与</li>
<li><strong>予約作成</strong>: チケットを使って予約を作成</li>
</ol>
<h3 id="%E5%AE%9F%E8%A3%85%E3%82%B3%E3%83%BC%E3%83%89%E4%BE%8B%E3%83%90%E3%83%83%E3%82%AF%E3%82%A8%E3%83%B3%E3%83%89">実装コード例（バックエンド）</h3>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_create_guest_member</span><span class="hljs-params">(client, guest_name, guest_email, guest_phone, ...)</span>:</span>
    <span class="hljs-comment"># 1. メンバー作成</span>
    member_response = client.create_member({
        <span class="hljs-string">"last_name"</span>: <span class="hljs-string">"ゲスト"</span>,
        <span class="hljs-string">"first_name"</span>: <span class="hljs-string">"太郎"</span>,
        <span class="hljs-string">"mail_address"</span>: guest_email,
        <span class="hljs-string">"tel"</span>: guest_phone,
        <span class="hljs-string">"plain_password"</span>: <span class="hljs-string">"自動生成パスワード"</span>,
        <span class="hljs-string">"gender"</span>: <span class="hljs-number">1</span>,
        <span class="hljs-string">"birthday"</span>: <span class="hljs-string">"2000-01-01"</span>,
        <span class="hljs-string">"studio_id"</span>: <span class="hljs-number">2</span>
    })
    member_id = member_response[<span class="hljs-string">"data"</span>][<span class="hljs-string">"member"</span>][<span class="hljs-string">"id"</span>]
    
    <span class="hljs-comment"># 2. チケット付与</span>
    ticket_response = client.grant_ticket_to_member(
        member_id, 
        ticket_id=<span class="hljs-number">5</span>,  <span class="hljs-comment"># Web予約チケット</span>
        num=<span class="hljs-number">1</span>
    )
    member_ticket_id = ticket_response[<span class="hljs-string">"data"</span>][<span class="hljs-string">"member_ticket"</span>][<span class="hljs-string">"id"</span>]
    
    <span class="hljs-keyword">return</span> member_id, member_ticket_id
</div></code></pre>
<h3 id="%E3%83%86%E3%82%B9%E3%83%88%E7%B5%90%E6%9E%9C2025-12-12-%E6%88%90%E5%8A%9F">テスト結果（2025-12-12 成功）</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># 1. メンバー作成</span>
作成されたメンバーID: 34

<span class="hljs-comment"># 2. チケット付与</span>
付与されたチケットID: 23

<span class="hljs-comment"># 3. 予約作成（自由枠）</span>
{
  <span class="hljs-string">"reservation"</span>: {
    <span class="hljs-string">"id"</span>: 1190,
    <span class="hljs-string">"member_id"</span>: 34,
    <span class="hljs-string">"member_ticket_id"</span>: 23,
    <span class="hljs-string">"status"</span>: 2,
    <span class="hljs-string">"start_at"</span>: <span class="hljs-string">"2025-09-30T21:00:00+09:00"</span>,
    <span class="hljs-string">"end_at"</span>: <span class="hljs-string">"2025-09-30T21:30:00+09:00"</span>
  }
}
</div></code></pre>
<hr>
<h2 id="1-%E5%9B%BA%E5%AE%9A%E6%9E%A0%E4%BA%88%E7%B4%84%E3%83%AC%E3%83%83%E3%82%B9%E3%83%B3%E4%BA%88%E7%B4%84">1. 固定枠予約（レッスン予約）</h2>
<h3 id="api-%E3%82%A8%E3%83%B3%E3%83%89%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88">API エンドポイント</h3>
<pre class="hljs"><code><div>POST /reservation/reservations/reserve
</div></code></pre>
<h3 id="%E5%BF%85%E9%A0%88%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF">必須パラメータ</h3>
<table>
<thead>
<tr>
<th>パラメータ</th>
<th>型</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>member_id</code></td>
<td>int</td>
<td>予約するメンバーのID</td>
</tr>
<tr>
<td><code>studio_lesson_id</code></td>
<td>int</td>
<td>レッスン枠のID</td>
</tr>
<tr>
<td><code>no</code></td>
<td>string</td>
<td>スペース番号（<code>studio_room_space.space_details[].no_label</code>の値）</td>
</tr>
<tr>
<td><code>member_ticket_id</code></td>
<td>int</td>
<td>メンバーが保有するチケットのID（チケット制の場合）</td>
</tr>
</tbody>
</table>
<h3 id="%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6%E7%AE%A1%E7%90%86%E7%94%BB%E9%9D%A2%E3%81%A7%E8%A8%AD%E5%AE%9A%E3%81%8C%E5%BF%85%E8%A6%81">前提条件（管理画面で設定が必要）</h3>
<h4 id="%E2%9C%85-1-%E5%BA%97%E8%88%97studio%E3%81%AE%E8%A8%AD%E5%AE%9A">✅ 1. 店舗（Studio）の設定</h4>
<ul>
<li>店舗が作成されていること</li>
<li><code>GET /master/studios</code> で確認</li>
</ul>
<h4 id="%E2%9C%85-2-%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0program%E3%81%AE%E8%A8%AD%E5%AE%9A">✅ 2. プログラム（Program）の設定</h4>
<ul>
<li>プログラムが作成され、有効になっていること</li>
<li>店舗に紐づいていること</li>
<li><code>GET /master/programs</code> で確認</li>
</ul>
<h4 id="%E2%9C%85-3-%E3%82%B9%E3%82%BF%E3%82%B8%E3%82%AA%E3%83%AB%E3%83%BC%E3%83%A0studio-room%E3%81%AE%E8%A8%AD%E5%AE%9A">✅ 3. スタジオルーム（Studio Room）の設定</h4>
<ul>
<li>部屋・エリアが作成されていること</li>
<li><strong>予約タイプ</strong>: 「固定枠予約」に設定</li>
<li><code>GET /master/studio-rooms</code> で確認</li>
</ul>
<h4 id="%E2%9C%85-4-%E3%82%B9%E3%82%BF%E3%82%B8%E3%82%AA%E3%83%AB%E3%83%BC%E3%83%A0%E3%82%B9%E3%83%9A%E3%83%BC%E3%82%B9studio-room-space%E3%81%AE%E8%A8%AD%E5%AE%9A-%E2%9A%A0%EF%B8%8F%E9%87%8D%E8%A6%81">✅ 4. スタジオルームスペース（Studio Room Space）の設定 ⚠️重要</h4>
<ul>
<li>スペース（席・ベッド等）が作成されていること</li>
<li><strong><code>space_details</code> に <code>no</code> フィールドが必要</strong>（予約時の席番号として使用）</li>
<li><code>GET /master/studio-room-spaces/{studio_room_id}</code> で確認</li>
</ul>
<pre class="hljs"><code><div>予約可能なスペースの条件:
space_details に &quot;no&quot; フィールドがあること

✅ 正しい例（Pilates Spaces）:
space_details: [
  {&quot;no&quot;: 1, &quot;coord_x&quot;: 0, &quot;coord_y&quot;: 0},
  {&quot;no&quot;: 2, &quot;coord_x&quot;: 1, &quot;coord_y&quot;: 0},
  {&quot;no&quot;: 3, &quot;coord_x&quot;: 2, &quot;coord_y&quot;: 0}
]
→ 席番号 1, 2, 3 に予約可能

❌ 間違った例（Bookom Space 10）:
space_details: [
  {&quot;type&quot;: &quot;POSITION&quot;, &quot;coord_x&quot;: 0, &quot;coord_y&quot;: 0, &quot;no_label&quot;: &quot;1&quot;}
]
→ &quot;no&quot; がないため予約不可！
</div></code></pre>
<p><strong><code>no</code> と <code>no_label</code> の違い:</strong></p>
<table>
<thead>
<tr>
<th>フィールド</th>
<th>用途</th>
<th>予約時の使用</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>no</code></td>
<td>席番号（実データ）</td>
<td>✅ 予約APIの <code>no</code> パラメータに使用</td>
</tr>
<tr>
<td><code>no_label</code></td>
<td>表示用ラベル</td>
<td>❌ 予約には使えない</td>
</tr>
</tbody>
</table>
<h4 id="%E2%9C%85-5-%E3%82%B9%E3%82%BF%E3%83%83%E3%83%95instructor%E3%81%AE%E8%A8%AD%E5%AE%9A">✅ 5. スタッフ（Instructor）の設定</h4>
<ul>
<li>スタッフが登録され、有効になっていること</li>
<li><code>GET /master/instructors</code> で確認</li>
</ul>
<h4 id="%E2%9C%85-6-%E3%83%AC%E3%83%83%E3%82%B9%E3%83%B3%E6%9E%A0studio-lesson%E3%81%AE%E4%BD%9C%E6%88%90">✅ 6. レッスン枠（Studio Lesson）の作成</h4>
<ul>
<li>レッスン枠が作成されていること</li>
<li><code>date</code>：レッスン日</li>
<li><code>start_at</code> / <code>end_at</code>：開始・終了時刻</li>
<li><code>program_id</code>：プログラムID</li>
<li><code>instructor_id</code>：担当スタッフID</li>
<li><code>studio_room_space_id</code>：スペースID</li>
<li><code>published_at</code>：公開日時（この日時以降に予約可能）</li>
<li><code>GET /master/studio-lessons</code> で確認</li>
<li><code>POST /master/studio-lessons</code> で作成</li>
</ul>
<h4 id="%E2%9C%85-7-%E3%83%A1%E3%83%B3%E3%83%90%E3%83%BCmember%E3%81%AE%E4%BD%9C%E6%88%90">✅ 7. メンバー（Member）の作成</h4>
<ul>
<li>予約するメンバーが登録されていること</li>
<li><strong>必須フィールド</strong>:
<ul>
<li><code>last_name</code>：姓</li>
<li><code>first_name</code>：名</li>
<li><code>mail_address</code>：メールアドレス</li>
<li><code>plain_password</code>：パスワード</li>
<li><code>gender</code>：性別（1=男性, 2=女性）</li>
<li><code>birthday</code>：生年月日</li>
<li><code>studio_id</code>：所属店舗ID</li>
</ul>
</li>
<li><code>POST /member/members</code> で作成</li>
</ul>
<h4 id="%E2%9C%85-8-%E3%83%81%E3%82%B1%E3%83%83%E3%83%88%E3%81%AE%E4%BB%98%E4%B8%8E%E3%83%81%E3%82%B1%E3%83%83%E3%83%88%E5%88%B6%E3%81%AE%E5%A0%B4%E5%90%88">✅ 8. チケットの付与（チケット制の場合）</h4>
<ul>
<li>メンバーにチケットを付与していること</li>
<li>チケットがプログラムで使用可能に設定されていること</li>
<li><code>POST /member/members/{member_id}/member_tickets</code> で付与</li>
</ul>
<h3 id="%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%A8%E5%AF%BE%E5%87%A6%E6%B3%95">エラーと対処法</h3>
<table>
<thead>
<tr>
<th>エラーコード</th>
<th>メッセージ</th>
<th>原因・対処</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>CMN_000051</code></td>
<td>必須パラメータが含まれていません</td>
<td>上記必須パラメータを確認</td>
</tr>
<tr>
<td><code>CMN_000001</code></td>
<td>エラーが発生しました</td>
<td>スペースの <code>space_details</code> に <code>no</code> がない可能性</td>
</tr>
<tr>
<td><code>RSV_000005</code></td>
<td>チケットが不足しています</td>
<td>メンバーにチケットを付与する</td>
</tr>
<tr>
<td><code>RSV_000309</code></td>
<td>営業時間外の日時を指定することはできません</td>
<td>レッスン枠の日時が営業時間内か確認</td>
</tr>
<tr>
<td><code>SPACE_NO_MISSING</code></td>
<td>席番号が設定されていません</td>
<td>スペースの設定を修正（下記参照）</td>
</tr>
</tbody>
</table>
<h3 id="%E3%82%B9%E3%83%9A%E3%83%BC%E3%82%B9%E8%A8%AD%E5%AE%9A%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%AE%E5%AF%BE%E5%87%A6%E6%B3%95">スペース設定エラーの対処法</h3>
<p><code>CMN_000001</code>（汎用エラー）が出る場合、スペースの席設定が原因の可能性があります：</p>
<ol>
<li>
<p><strong>管理画面でスペース設定を確認</strong></p>
<ul>
<li>設定 → スタジオルームスペース</li>
<li>該当スペースの編集画面を開く</li>
</ul>
</li>
<li>
<p><strong>席を正しく追加</strong></p>
<ul>
<li>席を追加し、番号（no）を設定</li>
<li>例: 席1, 席2, 席3...</li>
</ul>
</li>
<li>
<p><strong>APIで確認</strong></p>
</li>
</ol>
<pre class="hljs"><code><div>GET /master/studio-room-spaces/{space_id}
<span class="hljs-comment"># space_details に "no" フィールドがあるか確認</span>
</div></code></pre>
<hr>
<h2 id="2-%E8%87%AA%E7%94%B1%E6%9E%A0%E4%BA%88%E7%B4%84choice%E4%BA%88%E7%B4%84">2. 自由枠予約（choice予約）</h2>
<h3 id="api-%E3%82%A8%E3%83%B3%E3%83%89%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88">API エンドポイント</h3>
<pre class="hljs"><code><div>POST /reservation/reservations/choice/reserve
</div></code></pre>
<h3 id="%E5%BF%85%E9%A0%88%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF">必須パラメータ</h3>
<table>
<thead>
<tr>
<th>パラメータ</th>
<th>型</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>member_id</code></td>
<td>int</td>
<td>予約するメンバーのID</td>
</tr>
<tr>
<td><code>studio_room_id</code></td>
<td>int</td>
<td>スタジオルームのID</td>
</tr>
<tr>
<td><code>program_id</code></td>
<td>int</td>
<td>プログラムのID</td>
</tr>
<tr>
<td><code>start_at</code></td>
<td>string</td>
<td>開始日時（<code>yyyy-MM-dd HH:mm:ss.fff</code> 形式）</td>
</tr>
<tr>
<td><code>instructor_ids</code></td>
<td>array[int]</td>
<td>担当スタッフIDの配列</td>
</tr>
<tr>
<td><code>ticket_id</code></td>
<td>int</td>
<td>チケットのID</td>
</tr>
</tbody>
</table>
<h3 id="%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6%E7%AE%A1%E7%90%86%E7%94%BB%E9%9D%A2%E3%81%A7%E8%A8%AD%E5%AE%9A%E3%81%8C%E5%BF%85%E8%A6%81">前提条件（管理画面で設定が必要）</h3>
<h4 id="%E2%9C%85-1-%E5%BA%97%E8%88%97studio%E3%81%AE%E8%A8%AD%E5%AE%9A">✅ 1. 店舗（Studio）の設定</h4>
<ul>
<li>店舗が作成されていること</li>
</ul>
<h4 id="%E2%9C%85-2-%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0program%E3%81%AE%E8%A8%AD%E5%AE%9A">✅ 2. プログラム（Program）の設定</h4>
<ul>
<li>プログラムが作成され、有効になっていること</li>
</ul>
<h4 id="%E2%9C%85-3-%E3%82%B9%E3%82%BF%E3%82%B8%E3%82%AA%E3%83%AB%E3%83%BC%E3%83%A0studio-room%E3%81%AE%E8%A8%AD%E5%AE%9A">✅ 3. スタジオルーム（Studio Room）の設定</h4>
<ul>
<li>部屋・エリアが作成されていること</li>
<li><strong>予約タイプ</strong>: 「自由枠予約」に設定</li>
<li><code>GET /master/studio-rooms</code> で確認</li>
</ul>
<h4 id="%E2%9C%85-4-%E3%82%B9%E3%82%BF%E3%82%B8%E3%82%AA%E3%83%AB%E3%83%BC%E3%83%A0%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9studio-room-service%E3%81%AE%E8%A8%AD%E5%AE%9A-%E2%9A%A0%EF%B8%8F%E9%87%8D%E8%A6%81">✅ 4. スタジオルームサービス（Studio Room Service）の設定 ⚠️重要</h4>
<ul>
<li>自由枠予約の設定が作成されていること</li>
<li><strong><code>start_date</code> / <code>end_date</code></strong>: 予約可能期間（この期間外は予約不可）</li>
<li><code>schedule_nick</code>：予約の時間刻み（分単位、例: 30）</li>
<li><code>GET /master/studio-room-services</code> で確認</li>
<li><code>POST /master/studio-room-services</code> で作成</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-comment">// 例: 自由枠予約設定</span>
{
  <span class="hljs-attr">"studio_room_id"</span>: <span class="hljs-number">3</span>,
  <span class="hljs-attr">"name"</span>: <span class="hljs-string">"自由枠予約"</span>,
  <span class="hljs-attr">"start_date"</span>: <span class="hljs-string">"2025-01-01"</span>,
  <span class="hljs-attr">"end_date"</span>: <span class="hljs-string">"2026-03-31"</span>,  <span class="hljs-comment">// ← この期間外は予約不可！</span>
  <span class="hljs-attr">"schedule_nick"</span>: <span class="hljs-number">30</span>,
  <span class="hljs-attr">"is_active"</span>: <span class="hljs-literal">true</span>
}
</div></code></pre>
<h4 id="%E2%9C%85-5-%E3%82%B9%E3%82%BF%E3%83%83%E3%83%95instructor%E3%81%AE%E8%A8%AD%E5%AE%9A">✅ 5. スタッフ（Instructor）の設定</h4>
<ul>
<li>スタッフが登録され、有効になっていること</li>
</ul>
<h4 id="%E2%9C%85-6-%E3%82%B7%E3%83%95%E3%83%88shift%E3%81%AE%E4%BD%9C%E6%88%90-%E2%9A%A0%EF%B8%8F%E9%87%8D%E8%A6%81">✅ 6. シフト（Shift）の作成 ⚠️重要</h4>
<ul>
<li><strong>月別シフト</strong>が作成されていること</li>
<li>管理画面の「シフト管理」で12ヶ月分のシフトを追加</li>
<li><code>GET /reservation/shifts</code> で確認</li>
</ul>
<pre class="hljs"><code><div>シフトがないと → shift_studio_business_hour が空 → 営業時間外エラー
</div></code></pre>
<h4 id="%E2%9C%85-7-%E5%96%B6%E6%A5%AD%E6%99%82%E9%96%93shift-studio-business-hour%E3%81%AE%E8%A8%AD%E5%AE%9A-%E2%9A%A0%EF%B8%8F%E9%87%8D%E8%A6%81">✅ 7. 営業時間（Shift Studio Business Hour）の設定 ⚠️重要</h4>
<ul>
<li>シフトに対して営業時間が設定されていること</li>
<li><code>is_holiday: false</code> で営業日として設定</li>
<li><code>GET /reservation/shift_studio_business_hours</code> で確認</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-comment">// 例: 営業時間</span>
{
  <span class="hljs-attr">"shift_id"</span>: <span class="hljs-number">12</span>,
  <span class="hljs-attr">"studio_id"</span>: <span class="hljs-number">2</span>,
  <span class="hljs-attr">"date"</span>: <span class="hljs-string">"2025-09-30"</span>,
  <span class="hljs-attr">"start_at"</span>: <span class="hljs-string">"2025-09-30T09:00:00+09:00"</span>,
  <span class="hljs-attr">"end_at"</span>: <span class="hljs-string">"2025-09-30T21:00:00+09:00"</span>,
  <span class="hljs-attr">"is_holiday"</span>: <span class="hljs-literal">false</span>
}
</div></code></pre>
<h4 id="%E2%9C%85-8-%E3%82%B9%E3%82%BF%E3%83%83%E3%83%95%E3%82%B7%E3%83%95%E3%83%88shift-instructor%E3%81%AE%E8%A8%AD%E5%AE%9A">✅ 8. スタッフシフト（Shift Instructor）の設定</h4>
<ul>
<li>スタッフのシフトが登録されていること</li>
<li>シフト時間内でないと予約不可</li>
<li>管理画面の「シフト管理」でスタッフのシフトを設定</li>
</ul>
<h4 id="%E2%9C%85-9-%E3%83%A1%E3%83%B3%E3%83%90%E3%83%BCmember%E3%81%AE%E4%BD%9C%E6%88%90">✅ 9. メンバー（Member）の作成</h4>
<ul>
<li>予約するメンバーが登録されていること</li>
<li>固定枠と同じ必須フィールド</li>
</ul>
<h4 id="%E2%9C%85-10-%E3%83%81%E3%82%B1%E3%83%83%E3%83%88%E3%81%AE%E4%BB%98%E4%B8%8E">✅ 10. チケットの付与</h4>
<ul>
<li>メンバーにチケットを付与していること</li>
<li>チケットがプログラムで使用可能に設定されていること</li>
</ul>
<h3 id="%E3%82%B9%E3%82%B1%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E7%A2%BA%E8%AA%8Dapi">スケジュール確認API</h3>
<p>予約可能な時間帯を確認するには：</p>
<pre class="hljs"><code><div>GET /reservation/reservations/choice/schedule?studio_room_id={id}&amp;date={yyyy-MM-dd}
</div></code></pre>
<p>レスポンス：</p>
<ul>
<li><code>shift_studio_business_hour</code>：営業時間</li>
<li><code>shift_instructor</code>：スタッフのシフト</li>
<li><code>reservation_assign_instructor</code>：予約済みスタッフ（この時間は予約不可）</li>
</ul>
<h3 id="%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%A8%E5%AF%BE%E5%87%A6%E6%B3%95">エラーと対処法</h3>
<table>
<thead>
<tr>
<th>エラーコード</th>
<th>メッセージ</th>
<th>原因・対処</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>CMN_000051</code></td>
<td>必須パラメータが含まれていません</td>
<td>上記必須パラメータを確認</td>
</tr>
<tr>
<td><code>RSV_000005</code></td>
<td>チケットが不足しています</td>
<td>メンバーにチケットを付与する</td>
</tr>
<tr>
<td><code>RSV_000308</code></td>
<td>スタッフが選択されていない、または不正</td>
<td><code>instructor_ids</code> を正しく指定</td>
</tr>
<tr>
<td><code>RSV_000309</code></td>
<td>営業時間外の日時を指定することはできません</td>
<td>下記チェックリスト参照</td>
</tr>
</tbody>
</table>
<h4 id="rsv000309-%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%AE%E3%83%81%E3%82%A7%E3%83%83%E3%82%AF%E3%83%AA%E3%82%B9%E3%83%88">RSV_000309 エラーのチェックリスト</h4>
<ol>
<li>
<p><strong>シフト（月別）が存在するか？</strong></p>
<ul>
<li>管理画面 → シフト管理 → 該当月のシフトを追加</li>
</ul>
</li>
<li>
<p><strong>営業時間が設定されているか？</strong></p>
<ul>
<li>管理画面 → シフト管理 → 該当日の営業時間を設定</li>
<li><code>is_holiday: false</code> になっているか</li>
</ul>
</li>
<li>
<p><strong>スタジオルームサービスの期間内か？</strong></p>
<ul>
<li><code>start_date</code> ～ <code>end_date</code> の範囲内か確認</li>
</ul>
</li>
<li>
<p><strong>スタッフのシフトが入っているか？</strong></p>
<ul>
<li>該当時間にスタッフのシフトがあるか確認</li>
</ul>
</li>
</ol>
<hr>
<h2 id="3-%E5%85%B1%E9%80%9A%E3%83%A1%E3%83%B3%E3%83%90%E3%83%BC%E4%BD%9C%E6%88%90%E3%81%AE%E5%BF%85%E9%A0%88%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF">3. 共通：メンバー作成の必須パラメータ</h2>
<pre class="hljs"><code><div>{
  <span class="hljs-attr">"last_name"</span>: <span class="hljs-string">"山田"</span>,
  <span class="hljs-attr">"first_name"</span>: <span class="hljs-string">"太郎"</span>,
  <span class="hljs-attr">"mail_address"</span>: <span class="hljs-string">"test@example.com"</span>,
  <span class="hljs-attr">"tel"</span>: <span class="hljs-string">"090-1234-5678"</span>,
  <span class="hljs-attr">"plain_password"</span>: <span class="hljs-string">"SecurePass123!"</span>,
  <span class="hljs-attr">"gender"</span>: <span class="hljs-number">1</span>,           <span class="hljs-comment">// 1=男性, 2=女性 (0は無効)</span>
  <span class="hljs-attr">"birthday"</span>: <span class="hljs-string">"1990-01-01"</span>,
  <span class="hljs-attr">"studio_id"</span>: <span class="hljs-number">2</span>
}
</div></code></pre>
<hr>
<h2 id="4-%E5%AE%9F%E9%9A%9B%E3%81%AE%E4%BA%88%E7%B4%84%E6%88%90%E5%8A%9F%E4%BE%8B">4. 実際の予約成功例</h2>
<h3 id="%E5%9B%BA%E5%AE%9A%E6%9E%A0%E4%BA%88%E7%B4%84%E3%83%AC%E3%83%83%E3%82%B9%E3%83%B3">固定枠予約（レッスン）</h3>
<pre class="hljs"><code><div>curl -X POST <span class="hljs-string">"https://happle.admin.egw.hacomono.app/api/v2/reservation/reservations/reserve"</span> \
  -H <span class="hljs-string">"Authorization: Bearer <span class="hljs-variable">$ACCESS_TOKEN</span>"</span> \
  -H <span class="hljs-string">"X-Requested-With: XMLHttpRequest"</span> \
  -H <span class="hljs-string">"Content-Type: application/json"</span> \
  -d <span class="hljs-string">'{
    "member_id": 33,
    "studio_lesson_id": 100,
    "no": "1",
    "member_ticket_id": 50
  }'</span>
</div></code></pre>
<h3 id="%E8%87%AA%E7%94%B1%E6%9E%A0%E4%BA%88%E7%B4%84choice">自由枠予約（choice）</h3>
<pre class="hljs"><code><div>curl -X POST <span class="hljs-string">"https://happle.admin.egw.hacomono.app/api/v2/reservation/reservations/choice/reserve"</span> \
  -H <span class="hljs-string">"Authorization: Bearer <span class="hljs-variable">$ACCESS_TOKEN</span>"</span> \
  -H <span class="hljs-string">"X-Requested-With: XMLHttpRequest"</span> \
  -H <span class="hljs-string">"Content-Type: application/json"</span> \
  -d <span class="hljs-string">'{
    "member_id": 33,
    "studio_room_id": 3,
    "program_id": 2,
    "ticket_id": 5,
    "instructor_ids": [1],
    "start_at": "2025-09-30 20:00:00.000"
  }'</span>
</div></code></pre>
<hr>
<h2 id="5-%E7%AE%A1%E7%90%86%E7%94%BB%E9%9D%A2%E3%81%A7%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%83%81%E3%82%A7%E3%83%83%E3%82%AF%E3%83%AA%E3%82%B9%E3%83%88">5. 管理画面での設定チェックリスト</h2>
<h3 id="%E5%9B%BA%E5%AE%9A%E6%9E%A0%E4%BA%88%E7%B4%84%E3%82%92%E4%BD%BF%E3%81%86%E5%A0%B4%E5%90%88">固定枠予約を使う場合</h3>
<ul>
<li><input type="checkbox" id="checkbox0"><label for="checkbox0">店舗を作成</label></li>
<li><input type="checkbox" id="checkbox1"><label for="checkbox1">プログラムを作成・有効化</label></li>
<li><input type="checkbox" id="checkbox2"><label for="checkbox2">スタジオルームを作成（予約タイプ：固定枠）</label></li>
<li><input type="checkbox" id="checkbox3"><label for="checkbox3">スペースを作成（no_label を設定）</label></li>
<li><input type="checkbox" id="checkbox4"><label for="checkbox4">スタッフを登録</label></li>
<li><input type="checkbox" id="checkbox5"><label for="checkbox5">レッスン枠を作成</label></li>
<li><input type="checkbox" id="checkbox6"><label for="checkbox6">チケットを作成・プログラムに紐づけ</label></li>
</ul>
<h3 id="%E8%87%AA%E7%94%B1%E6%9E%A0%E4%BA%88%E7%B4%84%E3%82%92%E4%BD%BF%E3%81%86%E5%A0%B4%E5%90%88">自由枠予約を使う場合</h3>
<ul>
<li><input type="checkbox" id="checkbox7"><label for="checkbox7">店舗を作成</label></li>
<li><input type="checkbox" id="checkbox8"><label for="checkbox8">プログラムを作成・有効化</label></li>
<li><input type="checkbox" id="checkbox9"><label for="checkbox9">スタジオルームを作成（予約タイプ：自由枠）</label></li>
<li><input type="checkbox" id="checkbox10"><label for="checkbox10"></label><strong>スタジオルームサービスを作成（期間を正しく設定！）</strong></li>
<li><input type="checkbox" id="checkbox11"><label for="checkbox11">スタッフを登録</label></li>
<li><input type="checkbox" id="checkbox12"><label for="checkbox12"></label><strong>シフト（月別）を追加</strong></li>
<li><input type="checkbox" id="checkbox13"><label for="checkbox13"></label><strong>営業時間を設定（定休日以外）</strong></li>
<li><input type="checkbox" id="checkbox14"><label for="checkbox14"></label><strong>スタッフのシフトを設定</strong></li>
<li><input type="checkbox" id="checkbox15"><label for="checkbox15">チケットを作成・プログラムに紐づけ</label></li>
</ul>
<hr>
<h2 id="6-%E3%82%88%E3%81%8F%E3%81%82%E3%82%8B%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%81%A8%E8%A7%A3%E6%B1%BA%E7%AD%96">6. よくあるトラブルと解決策</h2>
<h3 id="q-%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%8C%E7%99%BA%E7%94%9F%E3%81%97%E3%81%BE%E3%81%97%E3%81%9Fcmn000001%E3%81%8C%E5%87%BA%E3%82%8B">Q: 「エラーが発生しました」（CMN_000001）が出る</h3>
<p><strong>A</strong>: スペースの席設定が原因の可能性が高いです：</p>
<ol>
<li><strong>スペースの <code>space_details</code> に <code>no</code> フィールドがあるか確認</strong></li>
</ol>
<pre class="hljs"><code><div>GET /master/studio-room-spaces/{space_id}
</div></code></pre>
<ol start="2">
<li>
<p><strong><code>no</code> がない場合は管理画面で設定</strong></p>
<ul>
<li>設定 → スタジオルームスペース → 該当スペース</li>
<li>席を追加（no=1, no=2, ...）</li>
</ul>
</li>
<li>
<p><strong>バックエンドは <code>no</code> があるスペースのレッスンのみ表示</strong></p>
<ul>
<li>自動的にフィルタリングされます</li>
</ul>
</li>
</ol>
<h3 id="q-%E5%96%B6%E6%A5%AD%E6%99%82%E9%96%93%E5%A4%96%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%8C%E5%87%BA%E3%82%8B">Q: 「営業時間外」エラーが出る</h3>
<p><strong>A</strong>: 以下を順番にチェック：</p>
<ol>
<li>シフト（月別）が存在するか → 管理画面で追加</li>
<li>営業時間が設定されているか → 管理画面で設定</li>
<li>スタジオルームサービスの期間内か → API で <code>end_date</code> を延長</li>
<li>スタッフのシフトがあるか → 管理画面で設定</li>
</ol>
<h3 id="q-%E3%82%B9%E3%82%BF%E3%83%83%E3%83%95%E3%81%8C%E4%B8%8D%E6%AD%A3%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%8C%E5%87%BA%E3%82%8B">Q: 「スタッフが不正」エラーが出る</h3>
<p><strong>A</strong>: <code>instructor_ids</code> にシフトが入っているスタッフのIDを指定する。
<code>choice/schedule</code> API で <code>shift_instructor</code> を確認。</p>
<h3 id="q-%E3%83%81%E3%82%B1%E3%83%83%E3%83%88%E4%B8%8D%E8%B6%B3%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%8C%E5%87%BA%E3%82%8B">Q: 「チケット不足」エラーが出る</h3>
<p><strong>A</strong>: メンバーにチケットを付与する。チケットがプログラムで使えるよう設定。</p>
<h3 id="q-%E5%90%8C%E3%81%98%E3%83%A1%E3%83%B3%E3%83%90%E3%83%BC%E3%81%A7%E4%BA%88%E7%B4%84%E3%81%8C%E9%87%8D%E8%A4%87%E3%81%99%E3%82%8B">Q: 同じメンバーで予約が重複する</h3>
<p><strong>A</strong>: 新しいメンバーを作成するか、別の時間帯を選択する。</p>
<h3 id="q-%E3%83%AC%E3%83%83%E3%82%B9%E3%83%B3%E6%9E%A0%E3%81%8C%E8%A1%A8%E7%A4%BA%E3%81%95%E3%82%8C%E3%81%AA%E3%81%84">Q: レッスン枠が表示されない</h3>
<p><strong>A</strong>: スペースの席設定（<code>no</code>フィールド）がないレッスンは自動的にフィルタされます：</p>
<ol>
<li><strong>APIでスペースを確認</strong></li>
</ol>
<pre class="hljs"><code><div>GET /master/studio-room-spaces
<span class="hljs-comment"># space_details に "no" があるスペースのみ予約可能</span>
</div></code></pre>
<ol start="2">
<li><strong>予約可能なスペースを使用したレッスン枠を作成</strong></li>
</ol>

</body>
</html>
