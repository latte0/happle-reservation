version: '3.8'

services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    ports:
      - "5021:5021"
    environment:
      - PORT=5021
      - FLASK_ENV=development
      - HACOMONO_BRAND_CODE=happle
      - HACOMONO_CLIENT_ID=eGUjqThSvO2PofERi9fDHd5x3AzP29RVMSgtIL91JQA
      - HACOMONO_CLIENT_SECRET=XkfcnIIK54ttdjGnaugLQUB4trTpGFmkyJF3q0nxrKk
      - HACOMONO_ACCESS_TOKEN=${HACOMONO_ACCESS_TOKEN}
      - HACOMONO_REFRESH_TOKEN=${HACOMONO_REFRESH_TOKEN}
      - CORS_ORIGINS=http://localhost:3002,http://localhost:3001,http://localhost:3000,https://happle-reservation-frontend.onrender.com
      - SLACK_WEBHOOK_URL=${SLACK_WEBHOOK_URL}
      - SLACK_CLIENT_ID=${SLACK_CLIENT_ID}
      - SLACK_CLIENT_SECRET=${SLACK_CLIENT_SECRET}
      - SLACK_SIGNING_SECRET=${SLACK_SIGNING_SECRET}
      - SLACK_VERIFICATION_TOKEN=${SLACK_VERIFICATION_TOKEN}
    volumes:
      - ./backend:/app
    command: python app.py

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
      args:
        NEXT_PUBLIC_API_URL: http://localhost:5021
    ports:
      - "3002:3002"
    environment:
      - PORT=3002
      - NEXT_PUBLIC_API_URL=http://localhost:5021
    depends_on:
      - backend

