version: '3.8'

services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    ports:
      - "5011:5011"
    environment:
      - PORT=5011
      - FLASK_ENV=development
      - HACOMONO_BRAND_CODE=happle
      - HACOMONO_CLIENT_ID=eGUjqThSvO2PofERi9fDHd5x3AzP29RVMSgtIL91JQA
      - HACOMONO_CLIENT_SECRET=XkfcnIIK54ttdjGnaugLQUB4trTpGFmkyJF3q0nxrKk
      - HACOMONO_ACCESS_TOKEN=${HACOMONO_ACCESS_TOKEN}
      - HACOMONO_REFRESH_TOKEN=${HACOMONO_REFRESH_TOKEN}
      - CORS_ORIGINS=http://localhost:3002,http://localhost:3001,http://localhost:3000,https://happle-reservation-frontend.onrender.com
      # SES設定
      - SES_ACCESS_KEY_ID=${SES_ACCESS_KEY_ID}
      - SES_SECRET_ACCESS_KEY=${SES_SECRET_ACCESS_KEY}
      - SES_REGION=${SES_REGION:-ap-northeast-1}
      - SES_DOMAIN=${SES_DOMAIN:-reserve-now.jp}
      - SES_FROM_EMAIL=${SES_FROM_EMAIL:-noreply@reserve-now.jp}
      # Slack設定
      - SLACK_WEBHOOK_URL=${SLACK_WEBHOOK_URL}
    volumes:
      - ./backend:/app
    command: python app.py

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    ports:
      - "3002:3002"
    environment:
      - PORT=3002
      - NEXT_PUBLIC_API_URL=http://localhost:5021
    depends_on:
      - backend

